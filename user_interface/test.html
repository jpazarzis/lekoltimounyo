<!DOCTYPE html>
<html>
    <head>
         <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>


        <script>
        

        function mycallback(data)
        {
                var $secondChoice = $("#second-choice");
                $secondChoice.empty();
                for(var i = 0; i < data.length; ++i)
                {
                    $secondChoice.append('<option value= "'+ data[i].id +'" onclick="load_school_data(this.value);">' + data[i].name + "</option>");
                }
        }

        function school_data_callback(data)
        {
            /* 
            we have received the detailed data for a specific school in
            the form of a json document, where the key represents the field
            name while the value its field value. 

            Now let's go ahead and present this data to the user by creating
            an HTML table consisting of two columns (key - value)
            */

            $('#school_data').html('');
            var table = document.createElement("table");

            var x = '';
            $.each(data, function(field_name, field_value) {

                var row = document.createElement("tr");

                var field_name_cell = document.createElement("td");
                field_name_cell.appendChild(document.createTextNode(field_name));

                var field_value_cell = document.createElement("td");
                field_value_cell.appendChild(document.createTextNode(field_value));

                row.appendChild(field_name_cell);
                row.appendChild(field_value_cell);

                table.appendChild(row);
            });

            $('#school_data').append(table);
        }


        function load_school_data(school_id)
        {
            var url = 'http://localhost:5002/school/'+ school_id +'?callback=?';
            $.getJSON(url, null, school_data_callback);
        }

        function get_matching_schools()
        {
            var v = $("#school_name").val();
            if(v.length > 0)
            {
                var url = 'http://localhost:5002/matches/'+ v +'?callback=?'
                $.getJSON(url, null, mycallback);
            }
        }
        </script>
    </head>   
<body>
    <span>
    <input type="text" id="school_name" onkeyup='get_matching_schools()'><br>
    <select size=10 id='second-choice'>
          <option value="volvo">Volvo</option>
          <option value="saab">Saab</option>
          <option value="mercedes">Mercedes</option>
          <option value="audi">Audi</option>
    </select> 
    </span>

    <div id='school_data'>

        
    </div>
</body>
</html>
